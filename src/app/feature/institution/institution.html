<!-- Background Decoration -->
<div class="bg-blob bg-blob-1"></div>
<div class="bg-blob bg-blob-2"></div>
<div class="bg-blob bg-blob-3"></div>

<div class="institution-wrapper">

    <!-- Header -->
    <div class="inst-header">
        <h1 class="page-title">Institution Management</h1>
        <p class="page-subtitle">Create institutions and assign teachers with their semesters & subjects.</p>
    </div>

    <!-- Tab Navigation -->
    <div class="tab-bar">
        <button class="tab-btn" [class.active]="activeTab === 'institutions'" (click)="setTab('institutions')">
            <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            Institutions
        </button>
        <button class="tab-btn" [class.active]="activeTab === 'teachers'" (click)="setTab('teachers')">
            <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            Teachers
        </button>
    </div>

    <!-- ‚ïê‚ïê‚ïê TAB 1: INSTITUTIONS ‚ïê‚ïê‚ïê -->
    <div class="tab-content" *ngIf="activeTab === 'institutions'">
        <div class="content-card">
            <div class="card-head">
                <div class="card-head-left">
                    <h2 class="card-title">Create Institution</h2>
                    <span class="card-meta">Add a new school or college</span>
                </div>
                <div class="count-badge">{{ institutions.length }} Total</div>
            </div>
            <div class="card-body">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Institution Name</label>
                        <input type="text" [(ngModel)]="newInstitution.name" placeholder="e.g. MIT Chennai"
                            class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Code</label>
                        <input type="text" [(ngModel)]="newInstitution.code" placeholder="e.g. MITC" class="form-input">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Address</label>
                    <input type="text" [(ngModel)]="newInstitution.address" placeholder="e.g. Anna Nagar, Chennai"
                        class="form-input">
                </div>
                <div class="form-actions">
                    <button class="btn-primary" [disabled]="!newInstitution.name || !newInstitution.code"
                        (click)="addInstitution()">
                        <span class="btn-icon">+</span> Add Institution
                    </button>
                </div>
            </div>
        </div>

        <!-- Institution List -->
        <div class="content-card mt-card" *ngIf="institutions.length > 0">
            <div class="card-head">
                <div class="card-head-left">
                    <h2 class="card-title">All Institutions</h2>
                    <span class="card-meta">Manage your institutions</span>
                </div>
            </div>
            <div class="list-items">
                <div class="list-item" *ngFor="let inst of institutions">
                    <div class="item-avatar">{{ inst.name.charAt(0) }}</div>
                    <div class="item-info">
                        <span class="item-name">{{ inst.name }}</span>
                        <span class="item-meta">{{ inst.code }} ¬∑ {{ inst.address || 'No address' }}</span>
                    </div>
                    <div class="item-badge">#{{ inst.id }}</div>
                </div>
            </div>
        </div>

        <div class="empty-state" *ngIf="institutions.length === 0">
            <div class="empty-icon">üè´</div>
            <span class="empty-text">No institutions yet. Create your first one above!</span>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê TAB 2: TEACHERS ‚ïê‚ïê‚ïê -->
    <div class="tab-content" *ngIf="activeTab === 'teachers'">

        <!-- Header with Add button -->
        <div class="teacher-header">
            <div>
                <h2 class="section-title">Assigned Teachers</h2>
                <span class="section-meta">{{ assignments.length }} teacher assignments</span>
            </div>
            <button class="btn-primary" (click)="openAddTeacherModal()" [disabled]="institutions.length === 0">
                <span class="btn-icon">+</span> Add Teacher
            </button>
        </div>

        <div class="no-inst-warning" *ngIf="institutions.length === 0">
            <span>‚ö†Ô∏è Create an institution first before adding teachers.</span>
        </div>

        <!-- Teachers Table -->
        <div class="content-card" *ngIf="assignments.length > 0">
            <div class="table-scroll">
                <table class="grade-table">
                    <thead>
                        <tr>
                            <th>No.</th>
                            <th>Teacher</th>
                            <th>Institution</th>
                            <th>Semester</th>
                            <th>Subject</th>
                            <th class="col-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="grade-row" *ngFor="let a of assignments; let i = index">
                            <td class="row-index">{{ i + 1 }}</td>
                            <td>
                                <div class="teacher-cell">
                                    <div class="teacher-avatar">{{ a.teacherName.charAt(0).toUpperCase() }}</div>
                                    <span class="teacher-name">{{ a.teacherName }}</span>
                                </div>
                            </td>
                            <td><span class="cell-text">{{ getInstitutionName(a.institutionId) }}</span></td>
                            <td><span class="cell-text">{{ getSemesterName(a.semesterId) }}</span></td>
                            <td>
                                <div class="subject-chip">
                                    <span class="chip-dot"></span>
                                    {{ getSubjectName(a.subjectId) }}
                                </div>
                            </td>
                            <td class="col-center">
                                <button class="btn-remove" (click)="removeAssignment(a.id)">‚úï Remove</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="empty-state" *ngIf="assignments.length === 0 && institutions.length > 0">
            <div class="empty-icon">üë®‚Äçüè´</div>
            <span class="empty-text">No teachers assigned yet. Click "Add Teacher" to get started!</span>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê ADD TEACHER MODAL ‚ïê‚ïê‚ïê -->
    <div class="modal-overlay" *ngIf="showAddTeacherModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Teacher</h3>
                <button class="close-btn" (click)="closeAddTeacherModal()">‚úï</button>
            </div>
            <div class="modal-body">

                <!-- Teacher Name -->
                <div class="form-group">
                    <label class="form-label">Teacher Username</label>
                    <input type="text" [(ngModel)]="newTeacher.teacherName" placeholder="e.g. john_teacher"
                        class="form-input">
                </div>

                <!-- Institution Dropdown -->
                <div class="form-group">
                    <label class="form-label">Institution</label>
                    <div class="dd-wrapper" [class.open]="instDropdownOpen">
                        <button type="button" class="dd-trigger" (click)="toggleInstDropdown($event)">
                            <span class="dd-value">{{ getSelectedInstName() }}</span>
                            <span class="dd-arrow" [class.rotate]="instDropdownOpen">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </span>
                        </button>
                        <div class="dd-dropdown" *ngIf="instDropdownOpen">
                            <div class="dd-option" *ngFor="let inst of institutions"
                                [class.selected]="newTeacher.institutionId === inst.id"
                                (click)="selectInstitutionForTeacher(inst)">
                                <span class="dd-opt-avatar">{{ inst.name.charAt(0) }}</span>
                                <div class="dd-opt-info">
                                    <span class="dd-opt-name">{{ inst.name }}</span>
                                    <span class="dd-opt-meta">{{ inst.code }}</span>
                                </div>
                                <span class="dd-opt-check" *ngIf="newTeacher.institutionId === inst.id">‚úì</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Semester -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Semester Name</label>
                        <input type="text" [(ngModel)]="newTeacher.semesterName" placeholder="e.g. Semester 1"
                            class="form-input">
                    </div>
                    <div class="form-group" style="max-width: 100px;">
                        <label class="form-label">Sem No.</label>
                        <input type="number" [(ngModel)]="newTeacher.semesterNumber" min="1" class="form-input">
                    </div>
                </div>

                <!-- Subject -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Subject Name</label>
                        <input type="text" [(ngModel)]="newTeacher.subjectName" placeholder="e.g. Mathematics"
                            class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Subject Code</label>
                        <input type="text" [(ngModel)]="newTeacher.subjectCode" placeholder="e.g. MAT101"
                            class="form-input">
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button class="btn-secondary" (click)="closeAddTeacherModal()">Cancel</button>
                <button class="btn-primary" [disabled]="!canAddTeacher" (click)="addTeacher()">
                    <span class="btn-icon">‚ö°</span> Add Teacher
                </button>
            </div>
        </div>
    </div>

</div>