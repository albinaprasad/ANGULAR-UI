<div class="dashboard-wrapper">

    <!-- ── Background Decorations ────────────────── -->
    <div class="bg-blob bg-blob-1"></div>
    <div class="bg-blob bg-blob-2"></div>
    <div class="bg-blob bg-blob-3"></div>
    <div class="bg-grid"></div>

    <!-- ── Page Header ────────────────────────────── -->
    <div class="dashboard-header">
        <div>
            <h1 class="page-title">Academic Results</h1>
            <p class="page-subtitle">Track your subject scores and overall semester performance</p>
        </div>
    </div>

    <!-- ── Semester Selector + Stats ─────────────── -->
    <div class="control-panel">

        <!-- Custom Dropdown -->
        <div class="select-group">
            <span class="select-label">
                <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                Semester Period
            </span>

            <div class="custom-dropdown-wrapper" [class.open]="dropdownOpen">

                <!-- Trigger -->
                <button type="button" class="dd-trigger" (click)="toggleDropdown()">
                    <div class="dd-trigger-inner">
                        <span class="dd-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M22 10v6M2 10l10-5 10 5-10 5z" />
                                <path d="M6 12v5c3 3 9 3 12 0v-5" />
                            </svg>
                        </span>
                        <div class="dd-trigger-text">
                            <span class="dd-selected-name">{{ selectedSemester?.name || 'Select Semester' }}</span>
                            <span class="dd-selected-meta">{{ semesterLabel(selectedSemesterId) }} · {{
                                selectedSemester?.subjects?.length }} subjects</span>
                        </div>
                    </div>
                    <span class="dd-chevron" [class.rotate]="dropdownOpen">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </span>
                </button>

                <!-- Options Panel -->
                <div class="dd-panel" *ngIf="dropdownOpen">
                    <div class="dd-panel-header">Choose a semester</div>
                    <ul class="dd-list">
                        <li *ngFor="let sem of semesters" class="dd-item"
                            [class.dd-item-active]="sem.id === +selectedSemesterId" (click)="selectSemester(sem)">
                            <div class="dd-item-num">{{ sem.id }}</div>
                            <div class="dd-item-body">
                                <span class="dd-item-name">{{ sem.name }}</span>
                                <span class="dd-item-year">{{ semesterLabel(sem.id) }}</span>
                            </div>
                            <span class="dd-item-check" *ngIf="sem.id === +selectedSemesterId">
                                <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                            </span>
                        </li>
                    </ul>
                </div>

            </div>
        </div>

        <!-- Summary Pills -->
        <div class="summary-pills" *ngIf="selectedSemester">
            <div class="pill">
                <span class="pill-value">{{ selectedSemester.subjects.length }}</span>
                <span class="pill-label">Subjects</span>
            </div>
            <div class="pill pill-pass">
                <span class="pill-value">{{ passCount }}</span>
                <span class="pill-label">Passed</span>
            </div>
        </div>
    </div>

    <!-- ── Grade Table ────────────────────────────── -->
    <div class="result-card" *ngIf="selectedSemester">
        <div class="card-head">
            <div class="card-head-left">
                <h2 class="card-title">{{ selectedSemester.name }} — Grade Sheet</h2>
                <span class="card-meta">Academic Year 2024–25</span>
            </div>
            <span class="official-badge">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M12 1l3.09 6.26L22 8.27l-5 4.87 1.18 6.88L12 16.77l-6.18 3.25L7 13.14 2 8.27l6.91-1.01L12 1z" />
                </svg>
                Official Record
            </span>
        </div>

        <div class="table-scroll">
            <table class="grade-table">
                <thead>
                    <tr>
                        <th style="width:40px">#</th>
                        <th>Subject</th>
                        <th class="col-center">Score / 100</th>
                        <th class="col-center">Grade</th>
                        <th class="col-center">Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let subject of selectedSemester.subjects; let i = index" class="grade-row">

                        <!-- Index -->
                        <td class="row-index">{{ i + 1 }}</td>

                        <!-- Subject -->
                        <td class="subject-cell">
                            <div class="subject-avatar" [style.background]="avatarColor(i)">
                                {{ subject.name[0] }}
                            </div>
                            <div class="subject-meta">
                                <span class="subject-name">{{ subject.name.split(' - ')[0] }}</span>
                                <span class="subject-code">CS-{{ 200 + i + (selectedSemester.id * 10) }}</span>
                            </div>
                        </td>

                        <!-- Score + bar -->
                        <td class="col-center score-cell">
                            <span class="score-num">{{ subject.marks !== null ? subject.marks : '—' }}</span>
                            <div class="score-bar-track">
                                <div class="score-bar-fill" [style.width.%]="subject.marks || 0"
                                    [class.bar-pass]="subject.marks && subject.marks >= 50"
                                    [class.bar-fail]="subject.marks && subject.marks < 50">
                                </div>
                            </div>
                        </td>

                        <!-- Letter Grade -->
                        <td class="col-center">
                            <span class="letter-grade" [class]="letterClass(subject.marks)">
                                {{ letterGrade(subject.marks) }}
                            </span>
                        </td>

                        <!-- Status badge -->
                        <td class="col-center">
                            <span class="status-chip" [class.chip-pass]="subject.marks && subject.marks >= 50"
                                [class.chip-fail]="subject.marks && subject.marks < 50"
                                [class.chip-pending]="!subject.marks">
                                <span class="chip-dot"></span>
                                {{ subject.marks ? (subject.marks >= 50 ? 'Pass' : 'Fail') : 'Pending' }}
                            </span>
                        </td>

                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Table Footer -->
        <div class="card-footer">
            <span class="footer-note">Scores are out of 100. Pass mark: 50</span>
        </div>
    </div>

</div>